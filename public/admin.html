<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Santa - Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/snowfall.css">
    <link rel="stylesheet" href="/css/components.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div class="snowfall"></div>
    <div class="container">
        <!-- Admin Login -->
        <div id="adminLoginCard" class="card">
            <div class="card-header">
                <h1 class="title christmas-title">üéÖ Admin Access üéÖ</h1>
            </div>
            <div class="card-body">
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminPassword">Admin Password</label>
                        <input type="password" id="adminPassword" required>
                    </div>
                    <div id="loginError" class="error-message" style="display: none;"></div>
                    <button type="submit" class="btn btn-primary">Login</button>
                    <a href="/" class="btn btn-text">‚Üê Back to Login</a>
                </form>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" style="display: none;">
            <div class="admin-header">
                <h1 class="title christmas-title"><i data-lucide="layout-dashboard"></i> Admin Dashboard</h1>
                <button id="adminLogoutBtn" class="btn btn-secondary"><i data-lucide="log-out"></i> Logout</button>
            </div>

            <div class="dashboard-container">
                <!-- Left Sidebar (25%) -->
                <div class="dashboard-sidebar">

                    <!-- Game Status Widget -->
                    <div class="widget-compact">
                        <div class="widget-header">
                            <div class="widget-icon"><i data-lucide="bar-chart-3"></i></div>
                            <h2 class="widget-title">Game Status</h2>
                        </div>
                        <div class="widget-body">
                            <div id="gameStatus" class="stats-grid"></div>
                            <button id="refreshStatusBtn" class="btn btn-secondary btn-sm" style="margin-top: 1rem; width: 100%;"><i data-lucide="refresh-cw"></i> Refresh</button>
                        </div>
                    </div>

                    <!-- Notifications Widget -->
                    <div class="widget-compact">
                        <div class="widget-header">
                            <div class="widget-icon"><i data-lucide="send"></i></div>
                            <h2 class="widget-title">Send Notifications</h2>
                        </div>
                        <div class="widget-body">
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <button id="sendGameStartBtn" class="btn btn-primary btn-sm"><i data-lucide="play-circle"></i> Game Start</button>
                                <button id="sendWishlistReminderBtn" class="btn btn-secondary btn-sm"><i data-lucide="list"></i> Wishlist</button>
                                <button id="sendShoppingReminderBtn" class="btn btn-secondary btn-sm"><i data-lucide="shopping-cart"></i> Shopping</button>
                                <button id="sendExchangeDayBtn" class="btn btn-primary btn-sm"><i data-lucide="gift"></i> Exchange Day</button>
                            </div>
                            <div id="smsStats" class="stats-grid" style="margin-top: 1rem;"></div>
                        </div>
                    </div>

                    <!-- Game Controls Widget -->
                    <div class="widget-compact">
                        <div class="widget-header">
                            <div class="widget-icon"><i data-lucide="settings"></i></div>
                            <h2 class="widget-title">Game Controls</h2>
                        </div>
                        <div class="widget-body">
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <button id="validateGameBtn" class="btn btn-secondary btn-sm"><i data-lucide="check-circle"></i> Validate</button>
                                <button id="resetAssignmentsBtn" class="btn btn-warning btn-sm"><i data-lucide="rotate-ccw"></i> Reset</button>
                                <button id="resetAllBtn" class="btn btn-danger btn-sm"><i data-lucide="trash-2"></i> Clear All</button>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Right Main Content (75%) -->
                <div class="dashboard-main">

                    <!-- Participant Management Widget -->
                    <div class="widget">
                        <div class="widget-header">
                            <div class="widget-icon"><i data-lucide="users"></i></div>
                            <h2 class="widget-title">Participants</h2>
                        </div>
                        <div class="widget-body">
                            <form id="addParticipantForm" class="admin-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <input type="text" id="newFirstName" placeholder="First Name" required>
                                    </div>
                                    <div class="form-group">
                                        <input type="tel" id="newPhoneNumber" placeholder="Phone Number" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary"><i data-lucide="user-plus"></i> Add</button>
                                </div>
                            </form>
                            <div id="participantsList" class="data-table data-table-scrollable"></div>
                        </div>
                    </div>

                    <!-- Exclusion Rules Widget -->
                    <div class="widget">
                        <div class="widget-header">
                            <div class="widget-icon"><i data-lucide="shield-ban"></i></div>
                            <h2 class="widget-title">Exclusion Rules</h2>
                        </div>
                        <div class="widget-body">
                            <form id="addExclusionForm" class="admin-form">
                                <div class="form-row">
                                    <select id="exclusionParticipant" required>
                                        <option value="">Select Participant</option>
                                    </select>
                                    <span>cannot pick</span>
                                    <select id="exclusionExcluded" required>
                                        <option value="">Select Person</option>
                                    </select>
                                    <input type="text" id="exclusionReason" placeholder="Reason (e.g., spouse)">
                                    <button type="submit" class="btn btn-primary"><i data-lucide="plus"></i> Add Rule</button>
                                </div>
                            </form>
                            <div id="exclusionsList" class="data-table data-table-scrollable"></div>
                            <h3 style="margin: 1.5rem 0 1rem 0; color: var(--dark-text);"><i data-lucide="home" style="width: 18px; height: 18px; vertical-align: middle;"></i> Family Group Quick-Add</h3>
                            <form id="addFamilyGroupForm" class="admin-form">
                                <div id="familyGroupSelector"></div>
                                <input type="text" id="familyReason" placeholder="Reason (e.g., family)" value="family">
                                <button type="submit" class="btn btn-primary"><i data-lucide="users-2"></i> Add Family Exclusions</button>
                            </form>
                        </div>
                    </div>

                    <!-- SMS Templates Widget -->
                    <div class="widget">
                        <div class="widget-header">
                            <div class="widget-icon"><i data-lucide="smartphone"></i></div>
                            <h2 class="widget-title">SMS Templates & Preview</h2>
                        </div>
                        <div class="widget-body">
                            <div id="smsTemplatesContainer" class="sms-templates-grid"></div>
                        </div>
                    </div>

                    <!-- SMS Logs & Queue Widget -->
                    <div class="widget">
                        <div class="widget-header">
                            <div class="widget-icon"><i data-lucide="clipboard-list"></i></div>
                            <h2 class="widget-title">SMS Logs & Message Queue</h2>
                        </div>
                        <div class="widget-body">
                            <div style="margin-bottom: 1rem;">
                                <button id="refreshLogsBtn" class="btn btn-secondary btn-sm"><i data-lucide="refresh-cw"></i> Refresh Logs</button>
                            </div>

                            <h3 style="margin: 1.5rem 0 0.75rem 0; color: var(--dark-text); font-size: 1rem;"><i data-lucide="clock" style="width: 16px; height: 16px; vertical-align: middle;"></i> Pending Messages (Queue)</h3>
                            <div id="smsQueueList" style="margin-bottom: 2rem;"></div>

                            <h3 style="margin: 1.5rem 0 0.75rem 0; color: var(--dark-text); font-size: 1rem;"><i data-lucide="mail-check" style="width: 16px; height: 16px; vertical-align: middle;"></i> Sent Messages (History)</h3>
                            <div id="smsSentList"></div>
                        </div>
                    </div>

                    <!-- Exchange Event Settings Widget -->
                    <div class="widget">
                        <div class="widget-header">
                            <div class="widget-icon"><i data-lucide="calendar"></i></div>
                            <h2 class="widget-title">Exchange Event Settings</h2>
                        </div>
                        <div class="widget-body">
                            <form id="eventSettingsForm">
                                <div class="form-group">
                                    <label for="exchangeTitle">Event Title</label>
                                    <input type="text" id="exchangeTitle" placeholder="e.g., McDaniel Family Christmas Exchange">
                                </div>
                                <div class="form-group">
                                    <label for="exchangeDate">Exchange Date</label>
                                    <input type="date" id="exchangeDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="exchangeTime">Exchange Time</label>
                                    <input type="time" id="exchangeTime" placeholder="e.g., 18:00">
                                </div>
                                <div class="form-group">
                                    <label for="exchangeLocation">Location/Address</label>
                                    <textarea id="exchangeLocation" rows="3" placeholder="e.g., 123 Main St, City, State 12345"></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary"><i data-lucide="save"></i> Save Settings</button>
                            </form>
                        </div>
                    </div>

                    <!-- SMS Template Editor Widget -->
                    <div class="widget">
                        <div class="widget-header">
                            <div class="widget-icon"><i data-lucide="mail"></i></div>
                            <h2 class="widget-title">Edit SMS Templates</h2>
                        </div>
                        <div class="widget-body">
                            <div id="smsTemplateEditor"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script src="/js/main.js"></script>
    <script src="/js/snowfall.js"></script>
    <script src="/js/admin.js"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Re-initialize icons when admin panel is shown or data is updated
        const originalShowElement = window.showElement;
        if (originalShowElement) {
            window.showElement = function(elementId) {
                originalShowElement(elementId);
                setTimeout(() => lucide.createIcons(), 100);
            };
        }
    </script>
</body>
</html>
